# Bio-Optical Models for Water Quality Analysis  


This repository has the implementation and tests of benchmarked bio-optic models that evaluates some water quality indexes by analyzing satellite images.
  

## Table of contents  

* [General Info](#general-info)
* [Getting Started](#getting-started)
* [Usage](#usage)
* [Testing](#testing)
* [Contributing](#contributing)
* [Links](#links)
* [Authors and Contributors](#authors-and-contributors)
* [License](#license)



## General Info  

In order to analyze the water quality of reservoirs and lakes by remote sensing methods, such as satellites images, bio-optical models were used. Those models are mathematical and statistical algorithms which can be used to predict different water quality indexes by analyzing the water-leaving radiance measured at different bands of electromagnetic spectrum by sensors
onboard satellites.

According to the literature there are different approaches used in bio-optical modeling
since simple models, based on empirical and semi-empirical relations, until mots complexes models based on radiative transfer theory.

Currently, this project implements a library of empirical and semi-empirical models which can be
used to predict the concentration of chlorophyll-a, total suspended solids, water transparency, turbidity, phycocyanin and the detection of macrophytes in aquatic environments.

All the original equations are adapted in order to be applied in images collected by MSI (Multispectral Instrument) sensor onboard [Sentinel-2A and Sentinel-2B platforms](https://earth.esa.int/web/sentinel/user-guides/sentinel-2-msi).

  
  
## Getting Started  

These instructions will get you a copy of the project up and running on your local machine for development and testing purposes.
  
  
### Technologies

To execute this project, you'll need the following technologies:
  
- 32- or 64-bit computer
- [Python 3](https://www.python.org/downloads/)


### Development

To start the development, it is necessary to clone or download Bitbucket repository in a directory of your choice:  
  
  
```git clone https://user@bitbucket.org/certi_repos/qda_modelos.git```


### Setup

This repository can be used as a complementary library for a main project and its modules can be used whenever they are necessary. 
All dependencies are listed in requirements.txt.

To install dependencies use the following command:  
  
```python3 -m pip install -r requirements.txt```

You can install dependencies directly in your machine or in a virtual environment of your choice, such as [VirtualEnv](https://virtualenv.pypa.io/en/latest/) or [Conda](https://docs.conda.io/en/latest/).


## Usage

First, import the required packages and desired methods:


```python
import rasterio as rio
import numpy

from models import total_suspended_solids_turbidity as turbidity
``` 


Set and open the respective band (or bands) required to analyze the indexes:


```python
B04_20m = rio.open("tests/assets/20m/B4_20m_20181224.tif").read()

reflectance_659nm_wavelength = B04_20m
```


Open the band image file and choose one or more methods to analyze the desired index: 


```python
meta = rio.open("tests/assets/20m/B4_20m_20181224.tif").meta
meta.update(driver="GTiff")
meta.update(dtype=rio.float32)

miller_mckee_2004 = turbidity.miller_mckee_2004(reflectance_659nm_wavelength)
```


Create and save the new image generated by the respectives bands of the chosen method:


```python
with rio.open("miller_mckee_2004.tif", "w", **meta) as dist:
    dist.write(miller_mckee_2004.astype(rio.float32))
```


## Testing

This repository implementations can be tested by running **pytest** command in **src** folder.  
  
```python3 -m pytest```
  

## Contributing


Contributions are always welcome!
To fix a bug or enhance an existing module, follow these steps:

- Fork the repo
- Create a new branch (```git checkout -b improve-feature```)
- Make the appropriate changes in the files
- Add changes to reflect the changes made
- Commit your changes (```git commit -am 'Improve feature'```)
- Push to the branch (```git push origin improve-feature```)
- Create a Pull Request


While contributing, remember to add tests to the new developed methods.



## Links 

- [A Comprehensive Review on Water Quality Parameters Estimation Using Remote Sensing Techniques](https://www.researchgate.net/publication/306240486_A_Comprehensive_Review_on_Water_Quality_Parameters_Estimation_Using_Remote_Sensing_Techniques)
- [Bio-optical Modeling and Remote Sensing of Inland Waters](https://www.sciencedirect.com/book/9780128046449/bio-optical-modeling-and-remote-sensing-of-inland-waters)



## Authors & Contributors

Developed by CERTI Foundation.

This research was supported by FOZ DO CHAPECÃ“ ENERGIA S.A research and technological development program, 

through the PD-02949-2405/2019 project, regulated by Brazilian Electricity Regulatory Agency (ANEEL).



## License

This repository is licensed under the terms of the BSD-style license.
